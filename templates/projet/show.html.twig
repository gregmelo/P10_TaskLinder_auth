{# templates/projet/show.html.twig #}

{% extends 'base.html.twig' %}

{% block title %}{{ projet.titre }} - TaskLinker{% endblock %}


{# En-tête de la fiche Projet avec liste des membres et bouton Modifier #}
{% block header_content %}
<div id="title-page">
    <div class="flex-header">
        <h1>{{ projet.titre }}</h1>
        <div class="user-list">
            {# AFFICHER LES MEMBRES (AVATARS) #}
            {% for membre in projet.membres %}
            <div class="avatar" title="{{ membre.prenom }} {{ membre.nom }}">
                {# Affiche les initiales (ex: N.D. -> ND) #}
                {{ membre.prenom|first|upper }}{{ membre.nom|first|upper }}
            </div>
            {% endfor %}
        </div>
        {# Lien de modification #}
        <a class="button" href="{{ path('app_projet_edit', {'id': projet.id}) }}">Modifier</a>
    </div>
</div>
{% endblock %}

{% block body %}
    {# Conteneur des Tâches #}
    <div id="tasks-container">
        
        {# Boucle sur les trois statuts définis dans le contrôleur #}
        {% for statut_name, taches in tachesParStatut %}
            <div class="task-column">
                <h2>{{ statut_name }}</h2>
                <div class="tasks-list">
                    
                    {# Boucle sur les tâches pour ce statut #}
                    {% for tache in taches %}
                        <a class="task" href="{{ path('app_tache_edit', {'id': tache.id}) }}">
                            <h3>{{ tache.titre }}</h3>
                            {% if tache.description is not empty %}
                                <p>{{ tache.description|length > 50 ? tache.description|slice(0, 50) ~ '...' : tache.description }}</p>
                            {% endif %}
                            <div class="task-infos">
                                
                                {% if tache.deadline %}
                                    <div class="task-deadline">
                                        <i class="fa-regular fa-calendar"></i> {{ tache.deadline|date('d/m/Y') }}
                                    </div>
                                {% endif %}

                                {% if tache.employeAssigne %}
                                    <div class="mini-user" title="{{ tache.employeAssigne.prenom }} {{ tache.employeAssigne.nom }}">
                                        {# Initiales de l'employé assigné #}
                                        {{ tache.employeAssigne.prenom|first|upper }}{{ tache.employeAssigne.nom|first|upper }}
                                    </div>
                                {% endif %}
                            </div>
                        </a>
                    {% endfor %}

                    {# Bouton Ajouter une tâche dans chaque colonne #}
                    <a href="{{ path('app_tache_add', {'projetId': projet.id, 'initialStatut': statut_name}) }}" class="task-add">
                        + Ajouter une tâche
                    </a>
                </div>
            </div>
        {% endfor %}
        
    </div>
{% endblock %}